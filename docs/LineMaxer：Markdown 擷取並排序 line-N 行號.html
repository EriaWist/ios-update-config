<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <title>LineMaxer：Markdown 擷取並排序 line-N 行號</title>
    <style>
      textarea {
        width: 100%;
        height: 200px;
        font-family: monospace;
      }
      button {
        margin-top: 10px;
        margin-right: 10px;
      }
      input[type="text"] {
        width: 100%;
        margin-top: 10px;
        font-family: monospace;
      }
      #result {
        margin-top: 10px;
        font-weight: bold;
        white-space: pre-wrap;
      }
    </style>
  </head>
  <body>
    <h1>LineMaxer：Markdown 擷取並排序行號或編號</h1>

    <h2>輸入文字內容</h2>
    <textarea
      id="inputText"
      placeholder="例如：line-3、line-88、 ..."
    ></textarea>

    <h3>自訂正則表達式（可用下方按鈕快速套用）</h3>
    <div>
      <button onclick="setRegex('line-(\\d+)')">使用 line-(\\d+)</button>
      <button onclick="setRegex('\\[\\]\\((\\d+)\\)')">使用 [](\\d+)</button>
      <button onclick="setRegex('(line-(\\d+))|\\[\\]\\((\\d+)\\)')">
        同時匹配 line-(N) 和 [](N)
      </button>
    </div>

    <input
      id="regexInput"
      type="text"
      placeholder="輸入正則，例如：line-(\\d+)"
      value="line-(\d+)"
    />

    <br />
    <button onclick="findAndSortLines()">找出並由大到小排序所有 N</button>

    <div id="result"></div>

    <script>
      function setRegex(pattern) {
        document.getElementById("regexInput").value = pattern;
      }

      function findAndSortLines() {
        const text = document.getElementById("inputText").value;
        const regexText = document.getElementById("regexInput").value.trim();
        let regex;

        try {
          regex = new RegExp(regexText, "g");
        } catch (err) {
          document.getElementById("result").textContent =
            "❌ 正則表達式錯誤：" + err.message;
          return;
        }

        const matches = [...text.matchAll(regex)];

        // 嘗試取得捕獲群組中的數字
        const nums = matches
          .map((m) => {
            for (let i = 1; i < m.length; i++) {
              const val = parseInt(m[i], 10);
              if (!isNaN(val)) return val;
            }
            return null;
          })
          .filter((n) => n !== null);

        const uniqueSorted = [...new Set(nums)].sort((a, b) => b - a);

        const resultDiv = document.getElementById("result");
        if (uniqueSorted.length > 0) {
          resultDiv.textContent =
            `✅ 共找到 ${uniqueSorted.length} 個匹配結果：\n` +
            uniqueSorted.join(", ");
        } else {
          resultDiv.textContent = "未找到任何符合的項目";
        }
      }
    </script>
  </body>
</html>
